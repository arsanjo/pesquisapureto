eu coloquei esse codigo e funcionou import streamlit as st import pandas as pd from datetime import datetime import os # ============================================================ # CONFIGURAÃ‡Ã•ES INICIAIS # ============================================================ st.set_page_config(page_title="Pesquisa de SatisfaÃ§Ã£o â€” Pureto Sushi & Burger", layout="wide") GOOGLE_REVIEW_LINK = "https://g.page/puretosushi/review" # ============================================================ # INICIALIZAÃ‡ÃƒO DE ESTADOS # ============================================================ # Inicializa o DataFrame para armazenar as respostas, se ainda nÃ£o existir if "respostas" not in st.session_state: st.session_state.respostas = pd.DataFrame(columns=[ "Data", "Nome", "Whatsapp", "Aniversario", "Como_Conheceu", "Segmento", "Nota1", "Nota2", "Nota3", "Nota4", "Nota5", "NPS", "Comentario" ]) # ============================================================ # FUNÃ‡ÃƒO DE CÃLCULO NPS # ============================================================ def calcular_nps(df): if df.empty: return 0, 0, 0, 0, 0 total = len(df) promotores = df[df["NPS"] >= 9].count().NPS detratores = df[df["NPS"] <= 6].count().NPS perc_prom = (promotores / total) * 100 perc_det = (detratores / total) * 100 perc_neut = 100 - perc_prom - perc_det nps_score = perc_prom - perc_det return nps_score, perc_prom, perc_neut, perc_det, total # ============================================================ # INTERFACE PRINCIPAL (CLIENTE) # ============================================================ st.title("Pesquisa de SatisfaÃ§Ã£o") st.markdown("Sua opiniÃ£o Ã© muito importante para nÃ³s! Leva menos de 1 minuto.") # --- MUDANÃ‡A PRINCIPAL: SELETOR DE SEGMENTO FORA DO FORMULÃRIO --- # Este widget agora fica fora do form para permitir o recarregamento automÃ¡tico da pÃ¡gina segmento = st.radio( "Primeiro, conte pra gente: onde foi sua experiÃªncia?", ["Restaurante (SalÃ£o)", "Delivery (Entrega)"], horizontal=True, key="segmento_selecionado" # Usar uma chave para manter o estado ) # O formulÃ¡rio comeÃ§a DEPOIS da seleÃ§Ã£o de segmento with st.form("formulario"): # Os campos de dados pessoais continuam no formulÃ¡rio col1, col2, col3 = st.columns([2, 2, 1]) nome = col1.text_input("Seu Nome Completo:") whatsapp = col2.text_input("Seu WhatsApp:") aniversario = col3.date_input("Data de AniversÃ¡rio:", value=None, # Melhor iniciar como None format="DD/MM/YYYY") como_conheceu = st.selectbox( "Como vocÃª conheceu o Pureto?", ["Instagram", "Facebook", "Google", "IndicaÃ§Ã£o de amigo ou familiar", "JÃ¡ era cliente do Delivery", "JÃ¡ era cliente do Restaurante", "Outro"] ) st.markdown("---") # ============================================================ # PERGUNTAS DINÃ‚MICAS (AGORA FUNCIONA AUTOMATICAMENTE) # ============================================================ # O bloco if/elif agora funciona porque a variÃ¡vel 'segmento' Ã© atualizada instantaneamente if segmento == "Restaurante (SalÃ£o)": st.subheader("ğŸ½ï¸ AvaliaÃ§Ã£o no SalÃ£o") # Usamos st.slider que Ã© mais visual para notas de 0 a 10 nota1 = st.slider("1ï¸âƒ£ Atendimento da equipe (cortesia, agilidade e simpatia):", 0, 10, key="nota1_salao") nota2 = st.slider("2ï¸âƒ£ Qualidade e sabor dos pratos:", 0, 10, key="nota2_salao") nota3 = st.slider("3ï¸âƒ£ Limpeza e conforto do ambiente:", 0, 10, key="nota3_salao") nota4 = st.slider("4ï¸âƒ£ O quanto vocÃª nos recomendaria a um amigo ou familiar?", 0, 10, key="nota4_salao") nota5 = None # NÃ£o hÃ¡ quinta nota para o salÃ£o nps = nota4 elif segmento == "Delivery (Entrega)": st.subheader("ğŸš— AvaliaÃ§Ã£o do Delivery") # Usamos st.slider aqui tambÃ©m nota1 = st.slider("1ï¸âƒ£ Facilidade e atendimento no pedido:", 0, 10, key="nota1_delivery") nota2 = st.slider("2ï¸âƒ£ Rapidez da entrega:", 0, 10, key="nota2_delivery") nota3 = st.slider("3ï¸âƒ£ Qualidade e sabor dos pratos entregues:", 0, 10, key="nota3_delivery") nota4 = st.slider("4ï¸âƒ£ CondiÃ§Ã£o da embalagem ao chegar:", 0, 10, key="nota4_delivery") nota5 = st.slider("5ï¸âƒ£ O quanto vocÃª nos recomendaria a um amigo ou familiar?", 0, 10, key="nota5_delivery") nps = nota5 st.markdown("---") comentario = st.text_area("ComentÃ¡rios, sugestÃµes, elogios ou reclamaÃ§Ãµes (opcional):", max_chars=500) # O botÃ£o de envio permanece no final do formulÃ¡rio submit = st.form_submit_button("Enviar Respostas") # ============================================================ # ENVIO E FEEDBACK (LÃ³gica permanece a mesma) # ============================================================ if submit: if not nome: st.error("Por favor, preencha seu nome.") elif not aniversario: st.error("Por favor, preencha sua data de aniversÃ¡rio.") else: aniversario_str = aniversario.strftime("%d/%m/%Y") nova_resposta = pd.DataFrame({ "Data": [datetime.now().strftime("%Y-%m-%d %H:%M:%S")], "Nome": [nome], "Whatsapp": [whatsapp], "Aniversario": [aniversario_str], "Como_Conheceu": [como_conheceu], "Segmento": [segmento], # A variÃ¡vel 'segmento' vem de fora do form "Nota1": [nota1], "Nota2": [nota2], "Nota3": [nota3], "Nota4": [nota4], "Nota5": [nota5], "NPS": [nps], "Comentario": [comentario] }) st.session_state.respostas = pd.concat([st.session_state.respostas, nova_resposta], ignore_index=True) st.success(f"{nome}, muito obrigado pelas suas respostas sinceras!") st.markdown(""" <div style='background-color:#e8f5e9;padding:20px;border-radius:10px;'> <h4>Seu feedback Ã© essencial para aperfeiÃ§oarmos cada detalhe do Pureto Sushi ğŸ£</h4> <p>Como forma de agradecimento, vocÃª ganhou um cupom especial de <b>10% de desconto</b> na sua prÃ³xima compra.</p> <p><b>Use o cÃ³digo:</b> <span style='color:#1565c0;'>PESQUISA</span></p> </div> """, unsafe_allow_html=True) if nps >= 9: st.balloons() st.markdown(f""" <div style='background-color:#fff3cd;padding:20px;border-radius:10px;margin-top:10px;'> <h4>ğŸŒŸ {nome}, jÃ¡ que vocÃª nos avaliou tÃ£o bem...</h4> <p>Seria incrÃ­vel se vocÃª pudesse deixar uma <b>avaliaÃ§Ã£o rÃ¡pida no Google</b> sobre sua experiÃªncia.</p> <a href='{GOOGLE_REVIEW_LINK}' target='_blank' style='background:#f0ad4e;color:white;padding:10px 20px;border-radius:5px;text-decoration:none;'>Deixar AvaliaÃ§Ã£o no Google</a> </div> """, unsafe_allow_html=True) # ============================================================ # PAINEL ADMINISTRATIVO (LÃ³gica permanece a mesma) # ============================================================ query_params = st.query_params if "admin" in query_params and query_params["admin"] == "1": st.title("ğŸ”’ Painel Administrativo") senha = st.text_input("Digite a senha de administrador:", type="password") if senha == os.getenv("ADMIN_PASSWORD", "pureto2025"): st.success("Acesso autorizado âœ…") df = st.session_state.respostas if not df.empty: nps_geral, _, _, _, _ = calcular_nps(df) st.metric("NPS Geral", f"{nps_geral:.1f}") csv = df.to_csv(index=False).encode("utf-8") st.download_button("ğŸ“¥ Baixar Respostas (CSV)", csv, "respostas_pesquisa.csv", "text/csv") st.dataframe(df.sort_values(by="Data", ascending=False), use_container_width=True) else: st.info("Nenhuma resposta coletada ainda.") elif senha: st.error("Senha incorreta.") # ============================================================ # RODAPÃ‰ (LÃ³gica permanece a mesma) # ============================================================ st.markdown(""" <hr> <div style='text-align:center; color:gray;'> Desenvolvido por <b>Arsanjo</b> â€” Romanos 8:37<br> <i>"Somos mais do que vencedores."</i> </div> """, unsafe_allow_html=True) Ã© igual ao que voce me mandou?
